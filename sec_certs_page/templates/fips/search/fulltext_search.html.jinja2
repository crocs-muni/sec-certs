{% extends "fips/search/base.html.jinja2" %}

{% from "fips/utils.html.jinja2" import render_pagination, render_plot, render_status, render_type, render_document_type %}

{% block search_content %}
    <div class="col-12 col-sm-10 mx-auto p-3 py-md-5">
        <script type="module">
            import {
                fulltextSearchSetup,
            } from "/static/search.js";

            $(function () {
                fulltextSearchSetup();
            })
        </script>

        <div id="pagination" class="table-responsive">
            {% if pagination %}
                <div style="text-align: center">
                    Took {{ "{:.3}".format(runtime + highlight_runtime) }} seconds
                    {%- if query -%}
                        <span data-bs-toggle="tooltip"
                                data-bs-html="true"
                                title="Parsed as <b>{{ query }}</b>">*
                        </span>
                    {%- endif -%}
                    {{ pagination.info }}
                </div>
                <div class="mt-4 mb-4">
                    {{ pagination.links }}
                </div>
            {% endif %}
            {% for result in results %}
                {% set idd = result["cert"]["cert_id"]|default("", true) %}
                <div class="my-5">
                    <table class="table table-bordered table-responsive search-result">
                        <colgroup>
                            <col style="width:10%">
                            <col style="width:70%">
                            <col style="width:10%">
                            <col style="width:10%">
                        </colgroup>
                        <thead>
                        <tr>
                            <td class="pl-1"><span class="result-category">{{ render_type(result["cert"]["web_data"]["module_type"]) }}</span>&nbsp;<span class="result-id">#{{ idd }}</span></td>
                            <td>
                                <span class="result-name"><a href="{{ url_for(".entry", hashid=result["hit"]["dgst"]) }}" class="result-link">{{ result["hit"]["name"] }}</a></span>
                            </td>
                            <td><span class="result-document">{{ render_document_type(result["hit"]["document_type"]) }}</span></td>
                            <td><span class="result-status">{{ render_status(result["hit"]["status"]) }}</span></td>
                        </tr>
                        </thead>
                        <tbody style="border-top-color: #dfe0e1">
                        {% if "highlights" in result %}
                            <tr>
                                <td colspan="4" class="result-matches">
                                    {{ result["highlights"]|safe }}
                                </td>
                            </tr>
                        {% endif %}
                        </tbody>
                    </table>
                </div>
            {% endfor %}
            {% if pagination %}
                <div class="mb-4">
                    {{ pagination.links }}
                </div>
            {% endif %}
        </div>
    </div>
{% endblock %}
